From fe53722004afaac72319ebcb8dcad32452169320 Mon Sep 17 00:00:00 2001
From: root <root@ns1.localhost.com>
Date: Wed, 25 Feb 2026 15:14:04 +0300
Subject: [PATCH] =?UTF-8?q?Sunucu=20uyarlamalar=C4=B1=20yap=C4=B1ld=C4=B1?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 backend/core/security.py              | 1 +
 backend/main.py                       | 2 +-
 backend/routes/auth_routes.py         | 4 +++-
 backend/services/cleanup_service.py   | 8 ++++++++
 backend/services/embedding_service.py | 1 +
 frontend/src/pages/LiveStudio.jsx     | 4 ++--
 frontend/src/pages/Upload.jsx         | 4 ++--
 frontend/src/pages/VideoDetail.jsx    | 2 +-
 frontend/src/pages/WatchPage.jsx      | 2 +-
 frontend/src/utils/urlHelper.js       | 2 +-
 10 files changed, 21 insertions(+), 9 deletions(-)

diff --git a/backend/core/security.py b/backend/core/security.py
index eb22ac97..e542f7d5 100644
--- a/backend/core/security.py
+++ b/backend/core/security.py
@@ -9,6 +9,7 @@ Features:
 - User authentication helpers
 """
 
+from __future__ import annotations
 from datetime import datetime, timedelta
 from typing import Optional, Union
 import bcrypt
diff --git a/backend/main.py b/backend/main.py
index b945fe12..6b42a545 100644
--- a/backend/main.py
+++ b/backend/main.py
@@ -43,7 +43,7 @@ app = FastAPI(
 # Configure CORS - Allow all for development to fix 403/CORS issues
 app.add_middleware(
     CORSMiddleware,
-    allow_origins=["http://localhost:3000", "http://127.0.0.1:3000"],
+    allow_origins=["*"],
     allow_credentials=True,
     allow_methods=["*"],
     allow_headers=["*"],
diff --git a/backend/routes/auth_routes.py b/backend/routes/auth_routes.py
index 01c344ae..d44d647b 100644
--- a/backend/routes/auth_routes.py
+++ b/backend/routes/auth_routes.py
@@ -1,3 +1,5 @@
+from __future__ import annotations
+import typing
 """
 Authentication Routes
 ---------------------
@@ -565,7 +567,7 @@ def unsubscribe_from_user(
     return {"message": "Unsubscribed successfully"}
 
 
-@router.get("/subscriptions", response_model=list[UserResponse])
+@router.get("/subscriptions", response_model=typing.List[UserResponse])
 def get_user_subscriptions(
     current_user: User = Depends(get_current_user),
     db: Session = Depends(get_db)
diff --git a/backend/services/cleanup_service.py b/backend/services/cleanup_service.py
index 98d79e91..4782a21f 100644
--- a/backend/services/cleanup_service.py
+++ b/backend/services/cleanup_service.py
@@ -15,6 +15,14 @@ import time
 import shutil
 import logging
 import asyncio
+import functools
+
+if not hasattr(asyncio, "to_thread"):
+    async def to_thread(func, *args, **kwargs):
+        loop = asyncio.get_running_loop()
+        return await loop.run_in_executor(None, functools.partial(func, *args, **kwargs))
+    asyncio.to_thread = to_thread
+
 import re
 from datetime import datetime, timedelta
 from pathlib import Path
diff --git a/backend/services/embedding_service.py b/backend/services/embedding_service.py
index 45006660..e3781687 100644
--- a/backend/services/embedding_service.py
+++ b/backend/services/embedding_service.py
@@ -1,3 +1,4 @@
+from __future__ import annotations
 import numpy as np
 import threading
 import logging
diff --git a/frontend/src/pages/LiveStudio.jsx b/frontend/src/pages/LiveStudio.jsx
index 887ed2d6..95f940c2 100644
--- a/frontend/src/pages/LiveStudio.jsx
+++ b/frontend/src/pages/LiveStudio.jsx
@@ -38,7 +38,7 @@ const LiveStudio = () => {
     const chatEndRef = useRef(null);
 
     // Hardcoded for UI demo
-    const rtmpUrl = "rtmp://127.0.0.1:1935/live";
+    const rtmpUrl = "rtmp://37.148.214.28:1935/live";
 
     const initPlayer = () => {
         if (isConnecting) return; // Spam koruması: Zaten bağlanıyorsa tekrar basmayı engelle
@@ -49,7 +49,7 @@ const LiveStudio = () => {
         }
 
         // Sabit ve kesin adresimiz:
-        const url = `http://127.0.0.1:8080/live/user2.flv`;
+        const url = `http://37.148.214.28/live/user2.flv`;
         console.log("BAĞLANTI DENENİYOR: ", url);
 
         const player = flvjs.createPlayer({
diff --git a/frontend/src/pages/Upload.jsx b/frontend/src/pages/Upload.jsx
index 2a1b477d..96a3ad97 100644
--- a/frontend/src/pages/Upload.jsx
+++ b/frontend/src/pages/Upload.jsx
@@ -164,7 +164,7 @@ const VideoWallBackground = ({ videoUrl }) => {
                 // Pathing: Include trailing slash
                 const response = await ApiClient.get('/videos/');
                 if (response.data && response.data.length > 0) {
-                    setVideoSource(`http://localhost:8000${response.data[0].video_url}`);
+                    setVideoSource(`http://37.148.214.28${response.data[0].video_url}`);
                 } else {
                     setVideoSource(null);
                 }
@@ -706,7 +706,7 @@ const Upload = () => {
                                                 className={`relative group cursor-pointer aspect-video bg-black rounded-xl overflow-hidden border-2 transition-all duration-300 shadow-xl ${selectedPreviewFrame === frame ? 'border-[#e50914] z-10 shadow-[0_0_20px_rgba(229,9,20,0.5)] ring-2 ring-[#e50914]/30' : 'border-transparent hover:border-gray-600 hover:shadow-2xl hover:shadow-red-900/40'} ${index === 0 ? 'origin-left' : (index === previewFrames.length - 1 ? 'origin-right' : 'origin-center')}`}
                                             >
                                                 <div className="absolute top-0 left-0 w-full bg-black/80 text-white text-[10px] text-center py-1 opacity-0 group-hover:opacity-100 transition-opacity uppercase tracking-widest font-bold z-20">Click to Select</div>
-                                                <img src={DOMPurify.sanitize(`http://localhost:8000/storage/uploads/previews/${encodeURIComponent(frame.split('/').pop())}?t=${uploadTimestamp}`, { ALLOWED_URI_REGEXP: /^(?:http:|https:|blob:)/ })} alt={`Frame ${index + 1}`} className="w-full h-full object-cover" onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_THUMBNAIL; }} />
+                                                <img src={DOMPurify.sanitize(`http://37.148.214.28/storage/uploads/previews/${encodeURIComponent(frame.split('/').pop())}?t=${uploadTimestamp}`, { ALLOWED_URI_REGEXP: /^(?:http:|https:|blob:)/ })} alt={`Frame ${index + 1}`} className="w-full h-full object-cover" onError={(e) => { e.target.onerror = null; e.target.src = FALLBACK_THUMBNAIL; }} />
                                                 {selectedPreviewFrame === frame && <div className="absolute inset-0 bg-[#e50914]/20 flex items-center justify-center backdrop-blur-[1px]"><div className="bg-[#e50914] text-white px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-widest shadow-lg transform scale-110 border border-white/20">Selected</div></div>}
                                                 <div className="absolute bottom-2 right-2 bg-black/80 px-2 py-1 rounded text-[10px] text-white font-mono opacity-0 group-hover:opacity-100 transition-opacity border border-white/10">FRAME {index + 1}</div>
                                             </motion.div>
diff --git a/frontend/src/pages/VideoDetail.jsx b/frontend/src/pages/VideoDetail.jsx
index 6226392d..1a697441 100644
--- a/frontend/src/pages/VideoDetail.jsx
+++ b/frontend/src/pages/VideoDetail.jsx
@@ -386,7 +386,7 @@ const VideoDetail = () => {
 
     // Rotating Fallback Strategy to demonstrate dynamic playback
     const EVEN_FALLBACK = "https://vjs.zencdn.net/v/oceans.mp4";
-    const ODD_FALLBACK = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";
+    const ODD_FALLBACK = "";
     const DYNAMIC_FALLBACK = (parseInt(id) % 2 === 0) ? EVEN_FALLBACK : ODD_FALLBACK;
 
     // Fail-Safe Playback: Priority to real backend URL, fallback to rotating test clips
diff --git a/frontend/src/pages/WatchPage.jsx b/frontend/src/pages/WatchPage.jsx
index 5d998f4d..532fcfe6 100644
--- a/frontend/src/pages/WatchPage.jsx
+++ b/frontend/src/pages/WatchPage.jsx
@@ -25,7 +25,7 @@ const WatchPage = () => {
     useEffect(() => {
         // Initialize Player
         if (flvjs.isSupported()) {
-            const url = `http://127.0.0.1:8080/live/${username}.flv`;
+            const url = `http://37.148.214.28/live/${username}.flv`;
             const player = flvjs.createPlayer({
                 type: 'flv',
                 url: url,
diff --git a/frontend/src/utils/urlHelper.js b/frontend/src/utils/urlHelper.js
index ae14829e..70d94249 100644
--- a/frontend/src/utils/urlHelper.js
+++ b/frontend/src/utils/urlHelper.js
@@ -3,7 +3,7 @@
  * Sanitizes and normalizes asset paths from the backend.
  */
 
-const BASE_URL = "http://localhost:8000";
+const BASE_URL = "http://37.148.214.28";
 
 export const getValidUrl = (path, fallback) => {
     if (!path || path === "" || path.includes('synthetic')) return fallback;
-- 
2.25.1

